{% extends "base.html" %}
{% load duration_extras %}
{% block title %}給与明細{% endblock %}

{% block content %}
{% with ym=object.year_month|default:year_month %}

    <div class="container py-4">
      <h2 class="fw-bold mb-1 print-heading">
        {{ staff.name }} 様　{{ ym|slice:":4" }}年{{ ym|slice:"4:" }}月 明細
        <form method="get" class="d-inline-flex align-items-center gap-2">
          <input type="month"
                name="ym"
                class="form-control form-control-sm"
                style="width: 170px;"
                value="{{ month_input_value|default:default_ym }}">
          <button class="btn btn-outline-primary btn-sm">表示</button>
        </form>
      </h2>
      
      <div class="mb-3 d-flex gap-2 no-print">
        <a href="{% url 'attendance:staff_list' %}?ym={{ ym }}" class="btn btn-sm btn-outline-secondary">
          ← 一覧へ戻る
        </a>
        <a href="{% url 'payroll:staff_list' %}?ym={{ ym }}" class="btn btn-sm btn-outline-secondary">
          ← 給与一覧へ
        </a>
        <a href="{% url 'payroll:payroll_export_staff_csv' staff.id ym %}"
          class="btn btn-sm btn-outline-secondary">
          CSV
        </a>    
        <a href="{% url 'payroll:payroll_staff_detail_month'
                  staff_id=object.staff_id
                  year_month=object.year_month %}?format=pdf" class="btn btn-sm btn-outline-primary">
                  PDF
        </a>
      <a class="btn btn-outline-primary"
        href="{% url 'payroll:staff_edit' payroll.staff.id %}?next={{ request.get_full_path|urlencode }}&ym={{ ym }}">
        スタッフ情報を編集
      </a>
    </div>

  <p class="text-muted text-end" style="margin-top:-5px;">
    {% if worktime_rule == "rounded" %}
      <span class="badge bg-primary">丸めモード</span><br>
      通常: ({{ normal_hours|floatformat:2 }} / {{ normal_hours_hhmm_rounded }})
      特別期間: ({{ special_hours|floatformat:2 }} / {{ special_hours_hhmm_rounded }})
      休日出勤: ({{ holiday_hours|floatformat:2 }} / {{ holiday_hours_hhmm_rounded }})
    {% else %}
      <span class="badge bg-success">実働モード</span><br>
      通常: ({{ normal_hours|floatformat:2 }} / {{ normal_hours_hhmm_actual }})
      特別期間: ({{ special_hours|floatformat:2 }} / {{ special_hours_hhmm_actual }})
      休日出勤: ({{ holiday_hours|floatformat:2 }} / {{ holiday_hours_hhmm_actual }})
    {% endif %}
  </p>
    <table class="table table-striped table-bordered text-end">
        <thead class="table-light">
          <tr>
            <th class="text-start">区分</th>
            <th>時間 h</th>
            <th>金額 ¥</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-start">通常</td>
            <td>{{ normal_hours|floatformat:2 }}</td>
            <td class="text-end">{{ breakdown.normal|yenfmt }}</td>
          </tr>
          <tr>
            <td class="text-start">特別期間</td>
            <td>{{ special_hours|floatformat:2 }}</td>
            <td class="text-end">{{ breakdown.special|yenfmt }}</td>
          </tr>
          <tr>
            <td class="text-start">休日出勤</td>
            <td>{{ holiday_hours|floatformat:2 }}</td>
            <td class="text-end">{{ breakdown.holiday|yenfmt }}</td>
          </tr>

        </tbody>
      </table>

      <h5 class="mt-4">支給・控除</h5>
      <div class="card w-50 shadow-sm bg-white rounded mt-3">
        <div class="card-body p-3">
          <ul class="list-group mb-0">
            <li class="list-group-item d-flex justify-content-between">
              <span>通勤手当</span><span>{{ object.commute_allowance|yenfmt }} 円</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>総支給額</span><strong>{{ gross_pay|default:payroll.gross_pay|yenfmt }} 円</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>雇用保険</span><span>{{ object.employment_insurance|yenfmt }} 円</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>健康保険</span><span>{{ object.health_insurance|yenfmt }} 円</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>厚生年金</span><span>{{ object.pension|yenfmt }} 円</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>住民税</span><span>{{ object.resident_tax|yenfmt }} 円</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>源泉徴収</span><span>{{ object.withholding_tax|yenfmt }} 円</span>
            </li>
            <li class="list-group-item d-flex justify-content-between fw-bold">
              <span>差引支給額</span><span>{{ net_pay|yenfmt }} 円</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
{% endwith %}
{% endblock %}