{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}
{% block title %}給与設定{% endblock %}

{% block content %}
<h2 class="mb-4 fw-bold">給与設定</h2>

<form method="post" action="{% url 'payroll:payroll_config' %}"
      class="card p-4 w-100"
      style="max-width:500px;">
  {% csrf_token %}
  {{ form.non_field_errors }}

  <!-- 週休日選択 -->
  <div class="flex-row align-items-center mb-3 gap-2 mt-4">
    <label class="fs-5">
      {{ form.weekly_holidays.label }}:
    </label>
    <div>
      {% for checkbox in form.weekly_holidays %}
        <div class="form-check form-check-inline">
          {{ checkbox.tag }}
          {{ checkbox.choice_label }}
        </div>
      {% endfor %}
    </div>
  </div>
  {{ form.weekly_holidays.errors }}

  <!-- 締め日（日付） -->
  <div class="d-flex flex-row align-items-center gap-2">
    <label class="fs-5 mb-3">
      {{ form.closing_day.label }}:
    </label>
    <div class="flex-grow-1 text-center mb-3">
      {{ form.closing_day|add_class:"form-control d-inline-block"|attr:"style:width:120px;" }}
    </div>
    <p class="text-danger closing_day mb-3">{{ form.closing_day.help_text }}</p>
    {{ form.closing_day.errors }}
  </div>

  <!-- 特別期間の時給倍率 -->
  <div class="d-flex flex-row align-items-center gap-2">
    <label class="fs-5">
      {{ form.special_rate.label }}:
    </label>
    {{ form.special_rate|add_class:"form-control"|attr:"style:width:120px;" }}
  </div>
  {% if form.special_rate.help_text %}
    <p class="text-danger special_rate mb-3">{{ form.special_rate.help_text }}</p>
  {% endif %}
  {{ form.special_rate.errors }}

  <!-- 雇用保険率 -->
  <div class="d-flex flex-row align-items-center mb-3 gap-2">
    <label class="fs-5">
      {{ form.employment_ins_rate.label }}:
    </label>
    {{ form.employment_ins_rate|add_class:"form-control"|attr:"style:width:120px;" }}
  </div>
  {{ form.employment_ins_rate.errors }}

  <h5 class="mt-3">昼休憩時間</h5>
  <div class="mb-2 d-flex gap-2 align-items-center">
    {{ form.lunch_break_from|add_class:"form-control"|attr:"style:width:120px;" }} 〜
    {{ form.lunch_break_to|add_class:"form-control"|attr:"style:width:120px;" }}
  </div>
  {% if form.non_field_errors %}
    <p class="text-danger">{{ form.non_field_errors }}</p>
  {% endif %}

  <h5 class="mt-3">正月期間</h5>
  <div class="mb-2 d-flex gap-2">
    {{ form.new_year_from }} 〜 {{ form.new_year_to }}
  </div>

  <h5 class="mt-3">盆期間</h5>
  <div class="mb-2 d-flex gap-2">
    {{ form.bon_from }} 〜 {{ form.bon_to }}
  </div>

  <h5 class="mt-3">特別休日等</h5>
  <div class="mb-2 d-flex gap-2">
    {{ form.gw_from }} 〜 {{ form.gw_to }}
  </div>

  <!-- 勤務時間の集計ルール -->
  <div class="mt-4 mb-3">
    <label class="fs-5" for="{{ form.worktime_rule.id_for_label }}">
      {{ form.worktime_rule.label }}:
    </label>
    <div>
      {{ form.worktime_rule|add_class:"form-select"|attr:"style:max-width:260px;" }}
    </div>
    <small class="form-text text-muted">
      集計方法を選択してください。<br>
      <b>丸め処理を行う（0.25時間単位）</b> … 実働時間を0.25h単位で四捨五入<br>
      <b>実働時間をそのまま集計</b> … 打刻された時間をそのまま合計
    </small>
    {{ form.worktime_rule.errors }}
  </div>

  <!-- メッセージ専用 -->
  {% if messages %}
  <div class="mt-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="閉じる"></button>
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <button class="btn btn-primary mt-3">保存</button>
</form>

<p class="mt-4"><a href="{% url 'attendance:staff_list' %}">← 一覧へ戻る</a></p>
{% endblock %}